{% extends 'base.html' %}

{% block title %}Home - To Do App{% endblock %}

{% block content %}


<h2>Welcome, {{ session_username }} to To Do App!</h2><br>

<p style="text-align:center; color:#555;">Manage your tasks efficiently and stay organized.</p>

<a href="{% url 'add_task' %}" style="
    display:inline-block;
    padding:10px 18px;
    background:#28a745;
    color:white;
    text-decoration:none;
    border-radius:6px;
    margin-bottom:10px;
    font-weight:500;
">+ Add Task</a>


<h3>Your Tasks</h3>

{% if tasks %}
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Date</th>
            <th>Time</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr>
            <td>{{ task.title }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.date }}</td>
            <td>{{ task.time }}</td>
            <td>
                <a href="{% url 'edit_task' task.task_id %}" style="color:#007bff; text-decoration:none; margin-right:10px;">Edit</a>
                <a href="#" 
                   onclick="showDeleteModal('{{ task.task_id }}', '{{ task.title|escapejs }}', '{{ task.description|escapejs }}', '{{ task.date }}', '{{ task.time }}')"
                   style="color:#dc3545; text-decoration:none;">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
    <p class="no-tasks">No tasks available.</p>
{% endif %}

<!-- Delete Confirmation Modal -->
<div id="deleteModal" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
">
    <div style="
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        max-width: 500px;
        width: 90%;
    ">
        <h3 style="color: #dc3545; margin-top: 0;">Confirm Deletion</h3>
        
        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
            <p><strong>Are you sure you want to delete this task?</strong></p>
            <div style="background: white; padding: 12px; border-radius: 4px; margin-top: 10px;">
                <p><strong>Title:</strong> <span id="modalTaskTitle"></span></p>
                <p><strong>Description:</strong> <span id="modalTaskDescription"></span></p>
                <p><strong>Date:</strong> <span id="modalTaskDate"></span></p>
                <p><strong>Time:</strong> <span id="modalTaskTime"></span></p>
            </div>
        </div>
        
        <p style="color: #dc3545; font-weight: bold; margin-bottom: 20px;">
            ⚠️ This action cannot be undone!
        </p>
        
        <div style="display: flex; gap: 15px;">
            <form id="deleteForm" method="post" action="" style="flex: 1;">
                {% csrf_token %}
                <button type="submit" style="
                    background: #dc3545;
                    color: white;
                    border: none;
                    padding: 12px 25px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: bold;
                    width: 100%;
                ">
                    Yes, Delete Task
                </button>
            </form>
            <button onclick="hideDeleteModal()" style="
                background: #6c757d;
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: bold;
                flex: 1;
            ">
                Cancel
            </button>
        </div>
    </div>
</div>

<script>
let currentTaskId = null;

function showDeleteModal(taskId, title, description, date, time) {
    currentTaskId = taskId;
    
    document.getElementById('modalTaskTitle').textContent = title;
    document.getElementById('modalTaskDescription').textContent = description || 'No description';
    document.getElementById('modalTaskDate').textContent = date;
    document.getElementById('modalTaskTime').textContent = time || 'No time set';
    
    document.getElementById('deleteForm').action = "{% url 'delete_task' 0 %}".replace('0', taskId);    
    document.getElementById('deleteModal').style.display = 'flex';
}


function hideDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
    currentTaskId = null;
}


document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideDeleteModal();
    }
});


document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        hideDeleteModal();
    }
});
</script>

{% endblock %}